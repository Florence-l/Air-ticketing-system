<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>航班查询结果</title>
    <link rel="stylesheet" th:href="@{layui/css/layui.css}">
    <link type="text/css" rel="stylesheet" href="/css/jqstyle.css"/>
    <link rel="stylesheet" href="/css/index.css"/>
    <script type="text/javascript" src="/js/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="/js/getUrl.js"></script>
    <style type="text/css">
        .btn{
            width: 100px;
            height: 30px;
            background: blue;
            border: none;
            color: white;
            margin: 6px 10px;
        }
        .btnStyle1{
            border-radius: 40px;
        }
    </style>
</head>
<body style="text-align: center">


<th:block th:include="common.html :: header"></th:block>
<div class="tab_contents" style="margin-top:40px;" >
<ul class="tab_box">
    <li class="tabBox_active">
        <form id="flightInquiry" action="/index" method="post" target="iframe">
            <div class="layui-form-item" style="font-size: 15px;color: #0C0C0C;font-family:'Microsoft YaHei'">
                <label class="layui-form-label" >出发地</label>
                <input name="departurecity" id="gdeparturecity" type="text" required="required" class="layui-input">
                <label class="layui-form-label">目的地</label>
                <input name="arrivalcity" id="garrivalcity" type="text" required="required" class="layui-input">
                <label class="layui-form-label">日期</label>
                <input name="date" id="gdate" type="text" required="required" class="layui-input" placeholder="格式如：yyyy.mm.dd">
            </div>
            <button type="submit" onclick="getid()">查询</button>
        </form>
        <iframe id="iframe" name="iframe" style="display:none;" ></iframe>
    </li>
</ul>
</div>

<div class="card">
    <h2 style="font-size: 18px">查询结果</h2>
    <div class="tab_box">
        <table class="layui-hide" id="flightList" lay-filter="flightList"></table>
    </div>
</div>

<th:block th:include="common.html :: footer"></th:block>
<script type="text/javascript">
    getid=function (){
        document.getElementById("flightInquiry").submit();
        var a = document.getElementById("gdeparturecity").value;
        var b= document.getElementById("garrivalcity").value;
        var c = document.getElementById("gdate").value;

        window.location.href='http://localhost:8080/result?departurecity='+a+'&arrivalcity='+b+'&date='+c;
    }
</script>

<script th:src="@{layui/layui.js}"></script>

<script>
    var departurecity = $.getUrlParam('departurecity');
    var arrivalcity = $.getUrlParam('arrivalcity');
    var date= $.getUrlParam('date');

    window.onload = function(){
        $("#gdeparturecity").val(departurecity);
        $("#garrivalcity").val(arrivalcity);
        $("#gdate").val(date);
    }
</script>

<script th:inline="none">
    var id;
    layui.use(['table'], function(){
        var table = layui.table;//使用数据表格

        table.render({
            elem: '#flightList'
            ,height: 500
            ,url: 'flight' //数据接口
            ,skin:'nob'
            ,size:'lg'
            ,limit: 10
            ,limits: [10, 20, 30, 50]
            ,page: true //开启分页
            ,data:[]
            ,cols: [[ //表头
                 {field: 'flight_id', title: '航班号', width: 100}
                ,{field: 'departurecity', title: '出发城市', width: 100}
                ,{field: 'arrivalcity', title: '到达城市', width: 100}
                ,{field: 'departuretime', title: '出发时间',sort: true, width: 120}
                ,{field: 'arrivaltime', title: '到达时间',sort: true, width: 130}
                ,{field: 'date', title: '日期', width: 120}
                ,{field: 'arrival_airport', title: '到达机场', width: 120}
                ,{field: 'departure_airport', title: '出发机场', width: 120}
                ,{field: 'action',title: '操作',templet:setTitle,width:100}
            ]]
        });
        function setTitle(obj){
            id=obj.flight_id;
            var btn="";
            btn +='<button class="layui-btn layui-btn-xs layui-btn-radius layui-btn-primary" onclick="geti()">订票</button>'
            return btn;
        }
        geti=function (){
            window.location.href='http://localhost:8080/jieshouURL?id='+id;
        }

    });
</script>
</body>
</html>